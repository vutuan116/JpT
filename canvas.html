<HTML>

<head>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script>
        var preX;
        var preY;
        var paint;
        var canvas;
        var context;
        var needClickDF=true;

        $(function () {
            canvas = document.getElementById("canvas");
            context = canvas.getContext("2d");
            clearCanvas();
            $('#canvas').mousedown(
                function (e) {
                    preX = e.pageX - this.offsetLeft;
                    preY = e.pageY - this.offsetTop;
                    paint = true;
                });
            $('#canvas').mousemove(
                function (e) {
                    if (paint) {
                        var x = e.pageX - this.offsetLeft;
                        var y = e.pageY - this.offsetTop;
                        context.beginPath();
                        context.lineWidth = 25;
                        context.lineCap = 'round';
                        context.strokeStyle = 'red';
                        context.moveTo(preX, preY);
                        context.lineTo(x, y);
                        context.stroke();
                        preX = x;
                        preY = y;
                    }
                });
            $('#canvas').mouseenter(
                function (e) {
                    if (paint) {
                        preX = e.pageX - this.offsetLeft;
                        preY = e.pageY - this.offsetTop;
                    }
                });
            $("#canvas").mouseup(
                function () { paint = needClickDF; }
            );
            $('#canvas').mouseleave(
                function (e) {
                    paint = false;
                });
        });

        function clearCanvas(){
            context.fillStyle='#ffe6e6';
            context.fillRect(0,0,500,500);
        }

        function changeNeedClick(){
            needClickDF=!needClickDF;
        }
    </script>
</head>

<body>
    <canvas id="canvas" width="500px" height="500px" style="border:1px solid #000000;"></canvas>
    <br>
    <button onclick="changeNeedClick()">changeNeedClick</button>
    <button onclick="clearCanvas()">clear</button>
</body>

</HTML>
